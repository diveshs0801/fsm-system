generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id         String      @id @default(cuid())
  name       String
  email      String      @unique
  password   String
  role       UserRole    @default(TECHNICIAN)
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt
  technician Technician?
}

model Technician {
  id             String               @id @default(cuid())
  userId         String               @unique
  skills         String[]
  currentStatus  TechnicianStatus     @default(AVAILABLE)
  currentLat     Float?
  currentLng     Float?
  createdAt      DateTime             @default(now())
  updatedAt      DateTime             @updatedAt
  specialty      ComplaintType?
  user           User                 @relation(fields: [userId], references: [id])
  schedules      TechnicianSchedule[]
  assignedOrders WorkOrder[]          @relation("TechnicianOrders")
}

model Customer {
  id                   String         @id @default(cuid())
  name                 String
  phone                String?
  email                String?
  address              String
  latitude             Float?
  longitude            Float?
  createdAt            DateTime       @default(now())
  updatedAt            DateTime       @updatedAt
  complaintDescription String?
  complaintType        ComplaintType?
  workOrders           WorkOrder[]
}

model WorkOrder {
  id             String               @id @default(cuid())
  title          String
  description    String?
  status         WorkOrderStatus      @default(PENDING)
  priority       PriorityLevel        @default(MEDIUM)
  scheduledDate  DateTime?
  completionDate DateTime?
  customerId     String
  technicianId   String?
  createdAt      DateTime             @default(now())
  updatedAt      DateTime             @updatedAt
  billing        Billing?
  customer       Customer             @relation(fields: [customerId], references: [id])
  technician     Technician?          @relation("TechnicianOrders", fields: [technicianId], references: [id])
  inventoryItems WorkOrderInventory[]
}

model InventoryItem {
  id         String               @id @default(cuid())
  name       String
  sku        String?
  quantity   Int                  @default(0)
  unitPrice  Float
  createdAt  DateTime             @default(now())
  updatedAt  DateTime             @updatedAt
  workOrders WorkOrderInventory[]
}

model WorkOrderInventory {
  id            String        @id @default(cuid())
  workOrderId   String
  inventoryId   String
  quantityUsed  Int           @default(1)
  inventoryItem InventoryItem @relation(fields: [inventoryId], references: [id])
  workOrder     WorkOrder     @relation(fields: [workOrderId], references: [id])
}

model Billing {
  id            String        @id @default(cuid())
  workOrderId   String        @unique
  totalAmount   Float         @default(0)
  status        BillingStatus @default(PENDING)
  invoiceNumber String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  workOrder     WorkOrder     @relation(fields: [workOrderId], references: [id])
}

model TechnicianSchedule {
  id            String     @id @default(cuid())
  technicianId  String
  date          DateTime
  routeOrder    Json
  totalDistance Float?
  totalDuration Float?
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  technician    Technician @relation(fields: [technicianId], references: [id])
}

enum UserRole {
  ADMIN
  TECHNICIAN
}

enum TechnicianStatus {
  AVAILABLE
  BUSY
  OFFLINE
}

enum WorkOrderStatus {
  PENDING
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum PriorityLevel {
  LOW
  MEDIUM
  HIGH
}

enum BillingStatus {
  PENDING
  PAID
  CANCELLED
}

enum ComplaintType {
  AC
  FAN
  CYLINDER
}
